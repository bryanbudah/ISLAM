{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>IlmHub | Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Fonts: Amiri -->
  <link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">

  <!-- Dark Mode Toggle -->
  <script defer>
    document.addEventListener('DOMContentLoaded', () => {
      const html = document.documentElement;
      const toggleBtn = document.getElementById('dark-toggle');

      if (localStorage.getItem('theme') === 'dark') {
        html.classList.add('dark');
      }

      toggleBtn.addEventListener('click', () => {
        html.classList.toggle('dark');
        localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
      });
    });
  </script>

  <style>
    body {
      font-family: 'Amiri', serif;
    }
  </style>
</head>

<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-100 transition-all">

  <!-- Navbar -->
  <nav class="bg-green-800 dark:bg-green-900 shadow-lg">
    <div class="max-w-7xl mx-auto px-4">
      <div class="flex justify-between items-center py-4">
        <!-- Logo -->
        <a href="{% url 'home' %}" class="text-2xl font-bold text-white flex items-center">
          🕌 IlmHub
        </a>

        <!-- Desktop Menu -->
        <div class="hidden md:flex items-center space-x-6 text-sm">
          <a href="{% url 'course-list' %}" class="hover:underline">Browse Courses</a>
          <a href="{% url 'article_list' %}" class="hover:underline">Articles</a>
          <a href="{% url 'event-list' %}" class="hover:underline">Events</a>

          {% if user.is_authenticated %}
            {% if user.is_staff or user.is_superuser %}
              <a href="{% url 'admin:index' %}" 
                 class="bg-yellow-400 text-black px-3 py-1 rounded hover:bg-yellow-300 transition">
                Admin Panel
              </a>
            {% else %}
              <a href="{% url 'dashboard' %}" class="hover:underline">Dashboard</a>
            {% endif %}
            <a href="{% url 'logout' %}" class="hover:underline">Logout</a>
          {% else %}
            <a href="{% url 'login' %}" class="hover:underline">Login</a>
          {% endif %}

          <!-- Dark Mode Toggle -->
          <button id="dark-toggle" 
                  class="bg-green-600 px-2 py-1 rounded text-white hover:bg-green-500 transition">
            🌙
          </button>
        </div>

        <!-- Mobile Menu Button -->
        <div class="md:hidden">
          <button id="mobile-menu-btn" class="text-white focus:outline-none">
            ☰
          </button>
        </div>
      </div>

      <!-- Mobile Menu -->
      <div id="mobile-menu" class="hidden flex-col space-y-2 pb-4 md:hidden text-white">
        <a href="{% url 'course-list' %}">Browse Courses</a>
        <a href="{% url 'article_list' %}">Articles</a>
        <a href="{% url 'event-list' %}">Events</a>
        {% if user.is_authenticated %}
          {% if user.is_staff or user.is_superuser %}
            <a href="{% url 'admin:index' %}" 
               class="bg-yellow-400 text-black px-3 py-1 rounded">
              Admin Panel
            </a>
          {% else %}
            <a href="{% url 'dashboard' %}">Dashboard</a>
          {% endif %}
          <a href="{% url 'logout' %}">Logout</a>
        {% else %}
          <a href="{% url 'login' %}">Login</a>
        {% endif %}
        <button id="dark-toggle-mobile" 
                class="bg-green-600 px-2 py-1 rounded text-white w-fit">
          🌙
        </button>
      </div>
    </div>
  </nav>

  <script>
    // Mobile menu toggle
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    mobileMenuBtn.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
    });
  </script>

  <!-- Hero Section -->
  <header class="text-center mt-10 px-4">
    <h1 class="text-4xl font-bold text-green-800 dark:text-green-400">
      Welcome to IlmHub
    </h1>
    <p class="italic text-xl mt-3 text-gray-700 dark:text-gray-300">
      “اقْرَأْ بِاسْمِ رَبِّكَ الَّذِي خَلَقَ”<br>
      <span class="text-sm">– Surah Al-‘Alaq 96:1</span>
    </p>
  </header>

  <!-- Featured Courses -->
  <section class="mt-16 px-4">
    <h2 class="text-2xl font-semibold text-center text-green-700 dark:text-green-300 mb-6">
      Featured Courses
    </h2>
    <div class="relative max-w-6xl mx-auto overflow-hidden">
      <div id="course-slider" class="flex gap-4 transition-transform duration-500 ease-in-out">
      {% for course in featured_courses %}
          <div class="min-w-full sm:min-w-[50%] md:min-w-[33.333%] bg-white dark:bg-gray-800 p-4 rounded shadow hover:shadow-lg transition">
            <h3 class="text-xl font-bold text-green-900 dark:text-white">{{ course.title }}</h3>
            <p class="text-sm text-gray-700 dark:text-gray-300 mt-2">
              {{ course.description|truncatewords:20 }}
            </p>
            {% if course.video_url %}
              <a href="{{ course.video_url }}" 
                 class="block mt-4 text-green-600 hover:underline">
                Watch Course
              </a>
            {% endif %}
          </div>
        {% empty %}
          <p class="text-center w-full">No courses available.</p>
        {% endfor %}
      </div>
    </div>
    <div class="text-center mt-4 space-x-2">
      <button onclick="moveSlide(-1)" class="px-3 py-1 bg-green-600 text-white rounded">‹</button>
      <button onclick="moveSlide(1)" class="px-3 py-1 bg-green-600 text-white rounded">›</button>
    </div>
    <script>
      let slider = document.getElementById('course-slider');
      let currentIndex = 0;
      function moveSlide(direction) {
        const maxIndex = slider.children.length - 1;
        currentIndex += direction;
        if (currentIndex < 0) currentIndex = maxIndex;
        if (currentIndex > maxIndex) currentIndex = 0;
        slider.style.transform = `translateX(-${currentIndex * 100}%)`;
      }
    </script>
  </section>

  <!-- Latest Article -->
  <section class="mt-20 px-4">
    <h2 class="text-2xl font-semibold text-center text-green-700 dark:text-green-300 mb-6">
      Latest Article
    </h2>
     {% for article in recent_articles %}
      <div class="max-w-3xl mx-auto bg-white dark:bg-gray-800 p-6 rounded shadow hover:shadow-lg transition text-center">
        <h3 class="text-xl font-bold">{{ article.title }}</h3>
        <p class="text-sm mt-2 text-gray-700 dark:text-gray-300">
          {{ article.content|truncatewords:30 }}
        </p>
        <a href="{% url 'article-list' %}" 
           class="mt-4 inline-block text-green-600 hover:underline">
          Read More
        </a>
      </div>
    {% empty %}
      <p class="text-center text-gray-500">No articles yet.</p>
    {% endfor %}
  </section>

  <!-- Upcoming Event -->
  <section class="mt-20 px-4 mb-24">
    <h2 class="text-2xl font-semibold text-center text-green-700 dark:text-green-300 mb-6">
      Upcoming Event
    </h2>
     {% for event in upcoming_events %}
      <div class="max-w-3xl mx-auto bg-white dark:bg-gray-800 p-6 rounded shadow hover:shadow-lg transition text-center">
        <h3 class="text-xl font-bold">{{ event.title }}</h3>
        <p class="text-gray-600 dark:text-gray-300">{{ event.description }}</p>
        <p class="mt-2 text-sm text-green-600">📆 {{ event.date }}</p>
        {% if event.rsvp_link %}
          <a href="{{ event.rsvp_link }}" 
             class="mt-4 inline-block bg-green-700 hover:bg-green-800 text-white px-4 py-2 rounded">
            RSVP Now
          </a>
        {% endif %}
      </div>
     {% empty %}
      <p class="text-center text-gray-500">No upcoming events at the moment.</p>
    {% endfor %}
  </section>

  <!-- Footer -->
  <footer class="bg-green-900 text-white text-center py-4 text-sm">
    &copy; {{ year|default:"2025" }} IlmHub – “The best among you are those who learn the Qur’an and teach it.” – Prophet Muhammad ﷺ
  </footer>
</body>
</html>
